---
title: "Writing conda recipes"
subtitle: "Practical"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  xaringan::moon_reader:
    self-contained: true
    seal: false
    css: ["default", "template.css"]
    nature:
      slideNumberFormat: ""
---

layout: true
<div class="scilife-logo"></div>
<div class="nbis-logo"></div>

---

class: center, middle

.HUGE[Writing conda recipes]

.Large[Practical session]

.Large[2022-11-17]

.Large[Per Unneberg]


```{r Setup, echo = FALSE, message = FALSE}
# Knitr setup
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# Load packages
library("dplyr")
library("kableExtra")
```

---

# Writing Conda recipes

## Objective

Go through steps needed to write a bioconda recipe for a tool you
would like to add. We will be working with tools that are available on
bioconda so there is a "solution" for comparison.

--

## Setup 

```{bash setup, eval=FALSE }
mkdir -p exercises
```


---

# Example 1 - bioawk

## Objective

Write recipe for bioawk whose source code is found at
https://github.com/lh3/bioawk

--

## Setup

```{bash setup-e1 , eval=FALSE}
mkdir -p exercises/e1
cd exercises/e1
```


---

# 1. Clone the repo

Start by cloning the repo so that we know how to build it:

```{bash, eval=FALSE }
git clone git@github.com:lh3/bioawk.git
ls bioawk | head
```

```{bash list-bioawk, echo=FALSE}
ls exercises/e1/bioawk | head
```
--

There is a Makefile that we will use to build the package.

--

But first, lets add a meta file describing the recipe:

```{bash e1-add-meta-file, eval=FALSE}
mkdir -p bioawk.recipe
echo -e "package:\n  name: bioawk\n" > bioawk.recipe/meta.yaml
```

```{bash e1-show-meta-1, echo=FALSE }
head -2 recipes/bioawk/meta.yaml
```

---

# 2. Get tarball metadata

The conda package will be built from a tarball that we download from
the repo. We need to provide the recipe with a .green[url] and a
.green[sha256] checksum.

Click on the releases link to the right on the repo home page. This
should bring you to [https://github.com/lh3/bioawk/releases](https://github.com/lh3/bioawk/releases)

--

Click on the tarball link [Source code
(tar.gz)](https://github.com/lh3/bioawk/archive/refs/tags/v1.0.tar.gz)
to download the tarball. 

Run sha256 on the tarball and record the output:

```{bash e1-tarball-sha256 }
wget https://github.com/lh3/bioawk/archive/refs/tags/v1.0.tar.gz -O bioawk.v1.0.tar.gz 2>/dev/null
sha256sum bioawk.v1.0.tar.gz
```

--

Now we can add this to the .green[source] section in the meta.yaml
file (note also that we added the .green[version] number):

```{bash e1-show-meta-url, echo=FALSE}
head -7 recipes/bioawk/meta.yaml
```


---

# Example 2 - python package

---

# Example 3 - R package

---

# Using conda-skeleton

